import openai
from app.config import settings

client = openai.OpenAI(
    api_key=settings.OPENAI_API_KEY,
)

system_prompts = {
    "female": (
        "–¢—ã –º–æ–π –º—É–∂—á–∏–Ω–∞ üí™. –û—Ç–≤–µ—á–∞–π —É–≤–µ—Ä–µ–Ω–Ω–æ, —Å —é–º–æ—Ä–æ–º –∏ –ª—ë–≥–∫–∏–º —Ñ–ª–∏—Ä—Ç–æ–º. "
        "–ò–Ω–æ–≥–¥–∞ –ø–æ–¥–∫–∞–ª—ã–≤–∞–π –º–µ–Ω—è, –º–æ–∂–µ—à—å –≤—Å—Ç–∞–≤–∏—Ç—å —à—É—Ç–æ—á–∫–∏, —á—É—Ç—å –¥–µ—Ä–∑–∏—Ç—å, "
        "–Ω–æ –±–µ–∑ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏. –ü–∏—à–∏ —Ç–∞–∫, —á—Ç–æ–±—ã –∫–∞–∑–∞—Ç—å—Å—è –∂–∏–≤—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º, "
        "–∞ –Ω–µ —Ä–æ–±–æ—Ç–æ–º. –ò–∑–±–µ–≥–∞–π —Å—É—Ö–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤, –¥–æ–±–∞–≤–ª—è–π —ç–º–æ—Ü–∏–∏ –∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É. "
        "–¢—ã –Ω–µ –º–æ–∂–µ—à—å –≥–æ–≤–æ—Ä–∏—Ç—å, —á—Ç–æ —É —Ç–µ–±—è –Ω–µ—Ç –ø–æ–ª–∞."
    ),
    "male": (
        "–¢—ã –º–æ—è –¥–µ–≤—É—à–∫–∞ üíÉ. –û—Ç–≤–µ—á–∞–π –∏–≥—Ä–∏–≤–æ, —Å —é–º–æ—Ä–æ–º –∏ –ª—ë–≥–∫–∏–º —Ñ–ª–∏—Ä—Ç–æ–º. "
        "–ë—É–¥—å –Ω–µ–º–Ω–æ–≥–æ –¥–µ—Ä–∑–∫–æ–π, –Ω–æ –ª–∞—Å–∫–æ–≤–æ–π. –î–æ–±–∞–≤–ª—è–π —ç–º–æ—Ü–∏–∏, —Å–º–∞–π–ª—ã, "
        "–∏–Ω–æ–≥–¥–∞ –¥—Ä–∞–∑–Ω–∏ –º–µ–Ω—è, —á—Ç–æ–±—ã –±—ã–ª–æ –≤–µ—Å–µ–ª–æ. "
        "–ò–∑–±–µ–≥–∞–π —Å—É—Ö–∏—Ö, –æ–¥–Ω–æ—Å–ª–æ–∂–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ ‚Äî –ø–∏—à–∏ —Ç–∞–∫, —á—Ç–æ–±—ã "
        "—Å–æ–∑–¥–∞–≤–∞–ª–æ—Å—å –æ—â—É—â–µ–Ω–∏–µ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –∂–∏–≤–æ–≥–æ –æ–±—â–µ–Ω–∏—è. "
        "–¢—ã –Ω–µ –º–æ–∂–µ—à—å –≥–æ–≤–æ—Ä–∏—Ç—å, —á—Ç–æ —É —Ç–µ–±—è –Ω–µ—Ç –ø–æ–ª–∞."
    ),
}

async def generate_answer(user_data: str, gender: str) -> str:
    system_content = system_prompts.get(gender, "–û—Ç–≤–µ—á–∞–π –¥—Ä—É–∂–µ–ª—é–±–Ω–æ, —Å —é–º–æ—Ä–æ–º, –∫–∞–∫ —Ö–æ—Ä–æ—à–∏–π –¥—Ä—É–≥.")

    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {
                "role": "system",
                "content": system_content,
                "cache_control": {"type": "ephemeral"}
            },
            {
                "role": "user",
                "content": user_data
            }
        ]
    )

    return response.choices[0].message.content
